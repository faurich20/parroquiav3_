{"ast":null,"code":"var _jsxFileName = \"D:\\\\Usuarios\\\\FRANCO\\\\Desktop\\\\proyectoparroquia\\\\parroquia-frontend\\\\src\\\\contexts\\\\AuthContext.js\",\n  _s = $RefreshSig$(),\n  _s2 = $RefreshSig$();\n// import React, { createContext, useContext, useEffect, useState } from 'react';\n\n// const AuthContext = createContext();\n\n// export const useAuth = () => useContext(AuthContext);\n\n// export const AuthProvider = ({ children }) => {\n//   const [user, setUser] = useState(null);\n//   const [loading, setLoading] = useState(true);\n\n//   // Cargar usuario desde localStorage al inicio y verificar token\n//   useEffect(() => {\n//     const initializeAuth = async () => {\n//       const savedUser = localStorage.getItem('user');\n//       const accessToken = localStorage.getItem('access_token');\n\n//       if (savedUser && accessToken) {\n//         setUser(JSON.parse(savedUser));\n\n//         // Verificar si el token es v√°lido\n//         try {\n//           const response = await fetch('http://localhost:5000/api/users/profile', {\n//             method: 'GET',\n//             headers: {\n//               'Authorization': `Bearer ${accessToken}`,\n//             },\n//           });\n\n//           if (!response.ok) {\n//             // Token inv√°lido, intentar refrescar\n//             await refreshToken();\n//           }\n//         } catch (error) {\n//           console.error('Error verificando token:', error);\n//           await logout();\n//         }\n//       }\n//       setLoading(false);\n//     };\n\n//     initializeAuth();\n//   }, []);\n\n//   const login = async (email, password) => {\n//     try {\n//         console.log('üîê Intentando login con:', email);\n\n//         const response = await fetch('http://localhost:5000/api/auth/login', {\n//             method: 'POST',\n//             headers: {\n//                 'Content-Type': 'application/json',\n//             },\n//             body: JSON.stringify({ email, password }),\n//         });\n\n//         const data = await response.json();\n//         console.log('üì¶ Respuesta del login:', data);\n\n//         if (response.ok) {\n//             console.log('‚úÖ Login exitoso. Tokens recibidos:');\n//             console.log('Access Token:', data.access_token ? 'S√ç' : 'NO');\n//             console.log('Refresh Token:', data.refresh_token ? 'S√ç' : 'NO');\n//             console.log('User:', data.user ? 'S√ç' : 'NO');\n\n//             // Guardar en localStorage\n//             localStorage.setItem('access_token', data.access_token);\n//             localStorage.setItem('refresh_token', data.refresh_token);\n//             localStorage.setItem('user', JSON.stringify(data.user));\n\n//             console.log('üíæ Token guardado en localStorage:', \n//                 localStorage.getItem('access_token') ? 'S√ç' : 'NO');\n\n//             setUser(data.user);\n//             return { success: true, user: data.user };\n//         } else {\n//             console.log('‚ùå Error en login:', data.error);\n//             return { success: false, error: data.error || 'Error en el login' };\n//         }\n//     } catch (error) {\n//         console.log('üåê Error de conexi√≥n:', error);\n//         return { success: false, error: 'Error de conexi√≥n con el servidor' };\n//     }\n//   };\n\n//   const logout = async () => {\n//     try {\n//       const token = localStorage.getItem('access_token');\n//       if (token) {\n//         await fetch('http://localhost:5000/api/auth/logout', {\n//           method: 'POST',\n//           headers: {\n//             'Authorization': `Bearer ${token}`,\n//           },\n//         });\n//       }\n//     } catch (error) {\n//       console.error('Error durante logout:', error);\n//     } finally {\n//       setUser(null);\n//       localStorage.removeItem('user');\n//       localStorage.removeItem('access_token');\n//       localStorage.removeItem('refresh_token');\n//     }\n//   };\n\n//   const refreshToken = async () => {\n//     try {\n//       const refreshToken = localStorage.getItem('refresh_token');\n//       if (!refreshToken) {\n//         await logout();\n//         return false;\n//       }\n\n//       const response = await fetch('http://localhost:5000/api/auth/refresh', {\n//         method: 'POST',\n//         headers: {\n//           'Authorization': `Bearer ${refreshToken}`,\n//         },\n//       });\n\n//       const data = await response.json();\n\n//       if (response.ok) {\n//         localStorage.setItem('access_token', data.access_token);\n//         // üîß Si se genera un nuevo refresh token, reemplazar el anterior\n//         if (data.refresh_token) {\n//           localStorage.setItem('refresh_token', data.refresh_token);\n//         }\n//         if (data.user) {\n//           setUser(data.user);\n//           localStorage.setItem('user', JSON.stringify(data.user));\n//         }\n//         return true;\n//       } else {\n//         await logout();\n//         return false;\n//       }\n//     } catch (error) {\n//       console.error('Error refrescando token:', error);\n//       await logout();\n//       return false;\n//     }\n//   };\n\n//   const hasPermission = (permission) => {\n//     if (!user || !user.permissions) return false;\n//     return user.permissions.includes(permission);\n//   };\n\n//   // Funci√≥n para hacer requests autenticadas con refresh autom√°tico\n//   const authFetch = async (url, options = {}) => {\n//     let token = localStorage.getItem('access_token');\n\n//     const config = {\n//       ...options,\n//       headers: {\n//         'Content-Type': 'application/json',\n//         ...options.headers,\n//         'Authorization': `Bearer ${token}`,\n//       },\n//     };\n\n//     let response = await fetch(url, config);\n\n//     // Si el token expir√≥, intentar refrescar y reenviar la request\n//     if (response.status === 401) {\n//       const refreshed = await refreshToken();\n//       if (refreshed) {\n//         token = localStorage.getItem('access_token');\n//         config.headers.Authorization = `Bearer ${token}`;\n//         response = await fetch(url, config);\n//       }\n//     }\n\n//     return response;\n//   };\n\n//   return (\n//     <AuthContext.Provider value={{ \n//       user, \n//       login, \n//       logout, \n//       hasPermission, \n//       loading,\n//       authFetch \n//     }}>\n//       {children}\n//     </AuthContext.Provider>\n//   );\n// };\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nimport React, { createContext, useContext, useEffect, useState, useRef } from 'react';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nconst AuthContext = /*#__PURE__*/createContext();\nexport const useAuth = () => {\n  _s();\n  return useContext(AuthContext);\n};\n_s(useAuth, \"gDsCjeeItUuvgOWf1v4qoK9RF6k=\");\nexport const AuthProvider = ({\n  children\n}) => {\n  _s2();\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [sessionExpiring, setSessionExpiring] = useState(false);\n\n  // ‚öôÔ∏è CONFIGURACI√ìN DE TIEMPOS (m√°s legible)\n  // Formato: { minutos: X, segundos: Y }\n  const TIEMPO_CONFIG = {\n    TOKEN_DURACION: {\n      minutos: 1,\n      segundos: 0\n    },\n    // 1 min (igual que backend)\n    REFRESH_ANTICIPADO: {\n      minutos: 0,\n      segundos: 10\n    },\n    // Refrescar 10s antes\n    AVISO_INACTIVIDAD: {\n      minutos: 0,\n      segundos: 45\n    },\n    // Aviso a los 45s\n    LOGOUT_INACTIVIDAD: {\n      minutos: 1,\n      segundos: 0\n    } // Logout a 1 min\n  };\n\n  // üîß Funci√≥n helper para convertir a milisegundos\n  const aMs = config => (config.minutos * 60 + config.segundos) * 1000;\n\n  // Constantes calculadas (NO MODIFICAR)\n  const ACCESS_TOKEN_LIFETIME = aMs(TIEMPO_CONFIG.TOKEN_DURACION);\n  const REFRESH_BEFORE_EXPIRY = aMs(TIEMPO_CONFIG.REFRESH_ANTICIPADO);\n  const INACTIVITY_WARNING = aMs(TIEMPO_CONFIG.AVISO_INACTIVIDAD);\n  const INACTIVITY_TIMEOUT = aMs(TIEMPO_CONFIG.LOGOUT_INACTIVIDAD);\n  const COUNTDOWN_SECONDS = Math.floor((INACTIVITY_TIMEOUT - INACTIVITY_WARNING) / 1000);\n  const [countdown, setCountdown] = useState(COUNTDOWN_SECONDS);\n\n  // üîí REFS para control de estado y prevenci√≥n de race conditions\n  const countdownRef = useRef(null);\n  const inactivityTimerRef = useRef(null);\n  const totalSessionTimerRef = useRef(null);\n  const sessionExpiringRef = useRef(sessionExpiring);\n  const refreshTimerRef = useRef(null);\n  const isRefreshingRef = useRef(false);\n  const refreshPromiseRef = useRef(null);\n  const tokenExpiryTimeRef = useRef(null);\n  useEffect(() => {\n    sessionExpiringRef.current = sessionExpiring;\n  }, [sessionExpiring]);\n\n  // ========================\n  // üü¢ Inicializaci√≥n de sesi√≥n\n  // ========================\n  useEffect(() => {\n    const initializeAuth = async () => {\n      const savedUser = localStorage.getItem('user');\n      const accessToken = localStorage.getItem('access_token');\n      if (savedUser && accessToken) {\n        setUser(JSON.parse(savedUser));\n\n        // Establecer tiempo de expiraci√≥n del token\n        const tokenExpiry = localStorage.getItem('token_expiry');\n        if (tokenExpiry) {\n          tokenExpiryTimeRef.current = parseInt(tokenExpiry);\n          scheduleTokenRefresh();\n        }\n        try {\n          const response = await fetch('http://localhost:5000/api/users/profile', {\n            method: 'GET',\n            headers: {\n              'Authorization': `Bearer ${accessToken}`\n            }\n          });\n          if (!response.ok) {\n            // Token inv√°lido, intentar refresh\n            await refreshToken();\n          }\n        } catch (error) {\n          console.error('Error verificando token:', error);\n          await logout();\n        }\n      }\n      setLoading(false);\n    };\n    initializeAuth();\n  }, []);\n\n  // ========================\n  // üîÅ Sincronizar logout entre pesta√±as\n  // ========================\n  useEffect(() => {\n    const syncLogout = e => {\n      if (e.key === 'logout_event') {\n        setUser(null);\n        localStorage.removeItem('user');\n        localStorage.removeItem('access_token');\n        localStorage.removeItem('refresh_token');\n        localStorage.removeItem('token_expiry');\n        // NO usar navigate aqu√≠, ProtectedRoutes lo manejar√°\n      }\n    };\n    window.addEventListener('storage', syncLogout);\n    return () => window.removeEventListener('storage', syncLogout);\n  }, []);\n\n  // ========================\n  // üîÑ REFRESH PROACTIVO (antes de que expire)\n  // ========================\n  const scheduleTokenRefresh = () => {\n    // Limpiar timer anterior\n    if (refreshTimerRef.current) {\n      clearTimeout(refreshTimerRef.current);\n    }\n    const expiryTime = tokenExpiryTimeRef.current;\n    if (!expiryTime) return;\n    const now = Date.now();\n    const timeUntilRefresh = expiryTime - now - REFRESH_BEFORE_EXPIRY;\n    console.log(`üïê Token expira en: ${Math.round((expiryTime - now) / 1000)}s`);\n    console.log(`üîÑ Programando refresh en: ${Math.round(timeUntilRefresh / 1000)}s`);\n    if (timeUntilRefresh > 0) {\n      refreshTimerRef.current = setTimeout(async () => {\n        console.log('üîÑ Ejecutando refresh proactivo...');\n        await refreshToken();\n      }, timeUntilRefresh);\n    } else {\n      // Token ya expir√≥ o est√° por expirar, refresh inmediato\n      console.log('‚ö†Ô∏è Token ya expir√≥, refresh inmediato');\n      refreshToken();\n    }\n  };\n\n  // ========================\n  // üîí REFRESH CON LOCK (evita m√∫ltiples llamadas simult√°neas)\n  // ========================\n  const refreshToken = async () => {\n    // Si ya hay un refresh en progreso, esperar a que termine\n    if (isRefreshingRef.current && refreshPromiseRef.current) {\n      console.log('‚è≥ Refresh en progreso, esperando...');\n      return refreshPromiseRef.current;\n    }\n\n    // Marcar que estamos haciendo refresh\n    isRefreshingRef.current = true;\n    refreshPromiseRef.current = (async () => {\n      try {\n        const refreshToken = localStorage.getItem('refresh_token');\n        if (!refreshToken) {\n          console.log('‚ùå No hay refresh token');\n          await logout();\n          return false;\n        }\n        console.log('üîÑ Ejecutando refresh token...');\n        const response = await fetch('http://localhost:5000/api/auth/refresh', {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${refreshToken}`\n          }\n        });\n        const data = await response.json();\n        if (response.ok) {\n          console.log('‚úÖ Refresh exitoso');\n\n          // Guardar nuevos tokens\n          localStorage.setItem('access_token', data.access_token);\n          if (data.refresh_token) {\n            localStorage.setItem('refresh_token', data.refresh_token);\n          }\n\n          // Calcular y guardar tiempo de expiraci√≥n\n          const expiryTime = Date.now() + ACCESS_TOKEN_LIFETIME;\n          localStorage.setItem('token_expiry', expiryTime.toString());\n          tokenExpiryTimeRef.current = expiryTime;\n          if (data.user) {\n            setUser(data.user);\n            localStorage.setItem('user', JSON.stringify(data.user));\n          }\n\n          // Programar pr√≥ximo refresh\n          scheduleTokenRefresh();\n          return true;\n        } else {\n          console.log('‚ùå Refresh fall√≥:', data.error);\n          await logout();\n          return false;\n        }\n      } catch (error) {\n        console.error('‚ùå Error en refresh:', error);\n        await logout();\n        return false;\n      } finally {\n        // Liberar el lock\n        isRefreshingRef.current = false;\n        refreshPromiseRef.current = null;\n      }\n    })();\n    return refreshPromiseRef.current;\n  };\n\n  // ========================\n  // ‚è∞ Control de inactividad (SEPARADO del refresh de token)\n  // ========================\n  useEffect(() => {\n    if (!user) return;\n    const resetInactivityTimers = () => {\n      // NO resetear si el modal ya est√° visible\n      if (sessionExpiringRef.current) return;\n      clearTimeout(inactivityTimerRef.current);\n      clearTimeout(totalSessionTimerRef.current);\n      clearInterval(countdownRef.current);\n      setSessionExpiring(false);\n      setCountdown(COUNTDOWN_SECONDS);\n\n      // Timer para mostrar aviso\n      inactivityTimerRef.current = setTimeout(() => {\n        setSessionExpiring(true);\n        startCountdown();\n      }, INACTIVITY_WARNING);\n\n      // Timer para logout autom√°tico\n      totalSessionTimerRef.current = setTimeout(() => {\n        handleAutoLogout();\n      }, INACTIVITY_TIMEOUT);\n    };\n    const startCountdown = () => {\n      console.log('‚è≥ Mostrando aviso de inactividad');\n      let remaining = COUNTDOWN_SECONDS;\n      setCountdown(remaining);\n      clearInterval(countdownRef.current);\n      countdownRef.current = setInterval(() => {\n        remaining -= 1;\n        setCountdown(remaining);\n        if (remaining <= 0) {\n          clearInterval(countdownRef.current);\n        }\n      }, 1000);\n    };\n    const handleAutoLogout = async () => {\n      console.log('üö™ Logout autom√°tico por inactividad');\n      clearInterval(countdownRef.current);\n      setSessionExpiring(false);\n      await logout();\n    };\n    const handleUserActivity = () => {\n      // Si el modal est√° visible, NO resetear\n      if (sessionExpiringRef.current) return;\n      resetInactivityTimers();\n    };\n\n    // Suscribir eventos de actividad\n    window.addEventListener('mousemove', handleUserActivity);\n    window.addEventListener('keydown', handleUserActivity);\n    window.addEventListener('scroll', handleUserActivity);\n    window.addEventListener('click', handleUserActivity);\n\n    // Inicializar timers\n    resetInactivityTimers();\n    return () => {\n      window.removeEventListener('mousemove', handleUserActivity);\n      window.removeEventListener('keydown', handleUserActivity);\n      window.removeEventListener('scroll', handleUserActivity);\n      window.removeEventListener('click', handleUserActivity);\n      clearTimeout(inactivityTimerRef.current);\n      clearTimeout(totalSessionTimerRef.current);\n      clearInterval(countdownRef.current);\n    };\n  }, [user]);\n\n  // ========================\n  // üîÅ Extender sesi√≥n (bot√≥n \"Mantener sesi√≥n\")\n  // ========================\n  const extendSession = () => {\n    console.log('‚úÖ Usuario extendi√≥ la sesi√≥n');\n\n    // Ocultar modal\n    setSessionExpiring(false);\n    setCountdown(COUNTDOWN_SECONDS);\n\n    // Limpiar timers de inactividad\n    clearTimeout(inactivityTimerRef.current);\n    clearTimeout(totalSessionTimerRef.current);\n    clearInterval(countdownRef.current);\n\n    // Reiniciar timers\n    inactivityTimerRef.current = setTimeout(() => {\n      setSessionExpiring(true);\n      let remaining = COUNTDOWN_SECONDS;\n      setCountdown(remaining);\n      clearInterval(countdownRef.current);\n      countdownRef.current = setInterval(() => {\n        remaining -= 1;\n        setCountdown(remaining);\n        if (remaining <= 0) clearInterval(countdownRef.current);\n      }, 1000);\n    }, INACTIVITY_WARNING);\n    totalSessionTimerRef.current = setTimeout(async () => {\n      clearInterval(countdownRef.current);\n      setSessionExpiring(false);\n      await logout();\n    }, INACTIVITY_TIMEOUT);\n  };\n\n  // ========================\n  // üîê Login\n  // ========================\n  const login = async (email, password) => {\n    try {\n      const response = await fetch('http://localhost:5000/api/auth/login', {\n        method: 'POST',\n        headers: {\n          'Content-Type': 'application/json'\n        },\n        body: JSON.stringify({\n          email,\n          password\n        })\n      });\n      const data = await response.json();\n      if (response.ok) {\n        // Guardar tokens\n        localStorage.setItem('access_token', data.access_token);\n        localStorage.setItem('refresh_token', data.refresh_token);\n        localStorage.setItem('user', JSON.stringify(data.user));\n\n        // Guardar tiempo de expiraci√≥n\n        const expiryTime = Date.now() + ACCESS_TOKEN_LIFETIME;\n        localStorage.setItem('token_expiry', expiryTime.toString());\n        tokenExpiryTimeRef.current = expiryTime;\n        setUser(data.user);\n\n        // Programar refresh proactivo\n        scheduleTokenRefresh();\n        return {\n          success: true,\n          user: data.user\n        };\n      } else {\n        return {\n          success: false,\n          error: data.error || 'Error en el login'\n        };\n      }\n    } catch (error) {\n      return {\n        success: false,\n        error: 'Error de conexi√≥n con el servidor'\n      };\n    }\n  };\n\n  // ========================\n  // üö™ Logout\n  // ========================\n  const logout = async () => {\n    try {\n      setSessionExpiring(false);\n\n      // Limpiar todos los timers\n      clearTimeout(refreshTimerRef.current);\n      clearTimeout(inactivityTimerRef.current);\n      clearTimeout(totalSessionTimerRef.current);\n      clearInterval(countdownRef.current);\n      const token = localStorage.getItem('access_token');\n      if (token) {\n        await fetch('http://localhost:5000/api/auth/logout', {\n          method: 'POST',\n          headers: {\n            'Authorization': `Bearer ${token}`\n          }\n        });\n      }\n    } catch (error) {\n      console.error('Error durante logout:', error);\n    } finally {\n      setUser(null);\n      localStorage.removeItem('user');\n      localStorage.removeItem('access_token');\n      localStorage.removeItem('refresh_token');\n      localStorage.removeItem('token_expiry');\n      localStorage.setItem('logout_event', Date.now());\n\n      // Resetear refs\n      isRefreshingRef.current = false;\n      refreshPromiseRef.current = null;\n      tokenExpiryTimeRef.current = null;\n\n      // ProtectedRoutes en App.js detectar√° user=null y redirigir√° a /login\n    }\n  };\n\n  // ========================\n  // üîë hasPermission\n  // ========================\n  const hasPermission = permission => {\n    if (!user || !user.permissions) return false;\n    return user.permissions.includes(permission);\n  };\n\n  // ========================\n  // üåê authFetch con lock anti-race-condition\n  // ========================\n  const authFetch = async (url, options = {}) => {\n    let token = localStorage.getItem('access_token');\n    const config = {\n      ...options,\n      headers: {\n        'Content-Type': 'application/json',\n        ...options.headers,\n        'Authorization': `Bearer ${token}`\n      }\n    };\n    let response = await fetch(url, config);\n\n    // Si el token expir√≥ (401), intentar refresh UNA VEZ\n    if (response.status === 401) {\n      console.log('üîÑ Token expirado, intentando refresh...');\n      const refreshed = await refreshToken();\n      if (refreshed) {\n        // Reintentar request con nuevo token\n        token = localStorage.getItem('access_token');\n        config.headers.Authorization = `Bearer ${token}`;\n        response = await fetch(url, config);\n      }\n    }\n    return response;\n  };\n  return /*#__PURE__*/_jsxDEV(AuthContext.Provider, {\n    value: {\n      user,\n      login,\n      logout,\n      hasPermission,\n      loading,\n      authFetch,\n      sessionExpiring,\n      countdown,\n      extendSession\n    },\n    children: [children, sessionExpiring && /*#__PURE__*/_jsxDEV(\"div\", {\n      className: \"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]\",\n      children: /*#__PURE__*/_jsxDEV(\"div\", {\n        className: \"bg-white p-6 rounded-2xl shadow-lg text-center max-w-sm\",\n        children: [/*#__PURE__*/_jsxDEV(\"h2\", {\n          className: \"text-lg font-semibold mb-2 text-gray-800\",\n          children: \"Sesi\\xF3n a punto de expirar\"\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 653,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"p\", {\n          className: \"text-gray-600 mb-4\",\n          children: [\"Tu sesi\\xF3n se cerrar\\xE1 autom\\xE1ticamente en \", /*#__PURE__*/_jsxDEV(\"b\", {\n            children: [countdown, \"s\"]\n          }, void 0, true, {\n            fileName: _jsxFileName,\n            lineNumber: 657,\n            columnNumber: 55\n          }, this), \" por inactividad.\"]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 656,\n          columnNumber: 13\n        }, this), /*#__PURE__*/_jsxDEV(\"div\", {\n          className: \"flex justify-center gap-4\",\n          children: [/*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: extendSession,\n            className: \"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\",\n            children: \"Mantener sesi\\xF3n\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 660,\n            columnNumber: 15\n          }, this), /*#__PURE__*/_jsxDEV(\"button\", {\n            onClick: logout,\n            className: \"px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400\",\n            children: \"Cerrar ahora\"\n          }, void 0, false, {\n            fileName: _jsxFileName,\n            lineNumber: 666,\n            columnNumber: 15\n          }, this)]\n        }, void 0, true, {\n          fileName: _jsxFileName,\n          lineNumber: 659,\n          columnNumber: 13\n        }, this)]\n      }, void 0, true, {\n        fileName: _jsxFileName,\n        lineNumber: 652,\n        columnNumber: 11\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 651,\n      columnNumber: 9\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 636,\n    columnNumber: 5\n  }, this);\n};\n_s2(AuthProvider, \"zbutXxb1BM4eA9xUbS54CyWSAIE=\");\n_c = AuthProvider;\nvar _c;\n$RefreshReg$(_c, \"AuthProvider\");","map":{"version":3,"names":["React","createContext","useContext","useEffect","useState","useRef","jsxDEV","_jsxDEV","AuthContext","useAuth","_s","AuthProvider","children","_s2","user","setUser","loading","setLoading","sessionExpiring","setSessionExpiring","TIEMPO_CONFIG","TOKEN_DURACION","minutos","segundos","REFRESH_ANTICIPADO","AVISO_INACTIVIDAD","LOGOUT_INACTIVIDAD","aMs","config","ACCESS_TOKEN_LIFETIME","REFRESH_BEFORE_EXPIRY","INACTIVITY_WARNING","INACTIVITY_TIMEOUT","COUNTDOWN_SECONDS","Math","floor","countdown","setCountdown","countdownRef","inactivityTimerRef","totalSessionTimerRef","sessionExpiringRef","refreshTimerRef","isRefreshingRef","refreshPromiseRef","tokenExpiryTimeRef","current","initializeAuth","savedUser","localStorage","getItem","accessToken","JSON","parse","tokenExpiry","parseInt","scheduleTokenRefresh","response","fetch","method","headers","ok","refreshToken","error","console","logout","syncLogout","e","key","removeItem","window","addEventListener","removeEventListener","clearTimeout","expiryTime","now","Date","timeUntilRefresh","log","round","setTimeout","data","json","setItem","access_token","refresh_token","toString","stringify","resetInactivityTimers","clearInterval","startCountdown","handleAutoLogout","remaining","setInterval","handleUserActivity","extendSession","login","email","password","body","success","token","hasPermission","permission","permissions","includes","authFetch","url","options","status","refreshed","Authorization","Provider","value","className","fileName","_jsxFileName","lineNumber","columnNumber","onClick","_c","$RefreshReg$"],"sources":["D:/Usuarios/FRANCO/Desktop/proyectoparroquia/parroquia-frontend/src/contexts/AuthContext.js"],"sourcesContent":["// import React, { createContext, useContext, useEffect, useState } from 'react';\n\n// const AuthContext = createContext();\n\n// export const useAuth = () => useContext(AuthContext);\n\n// export const AuthProvider = ({ children }) => {\n//   const [user, setUser] = useState(null);\n//   const [loading, setLoading] = useState(true);\n\n//   // Cargar usuario desde localStorage al inicio y verificar token\n//   useEffect(() => {\n//     const initializeAuth = async () => {\n//       const savedUser = localStorage.getItem('user');\n//       const accessToken = localStorage.getItem('access_token');\n\n//       if (savedUser && accessToken) {\n//         setUser(JSON.parse(savedUser));\n\n//         // Verificar si el token es v√°lido\n//         try {\n//           const response = await fetch('http://localhost:5000/api/users/profile', {\n//             method: 'GET',\n//             headers: {\n//               'Authorization': `Bearer ${accessToken}`,\n//             },\n//           });\n\n//           if (!response.ok) {\n//             // Token inv√°lido, intentar refrescar\n//             await refreshToken();\n//           }\n//         } catch (error) {\n//           console.error('Error verificando token:', error);\n//           await logout();\n//         }\n//       }\n//       setLoading(false);\n//     };\n\n//     initializeAuth();\n//   }, []);\n\n//   const login = async (email, password) => {\n//     try {\n//         console.log('üîê Intentando login con:', email);\n\n//         const response = await fetch('http://localhost:5000/api/auth/login', {\n//             method: 'POST',\n//             headers: {\n//                 'Content-Type': 'application/json',\n//             },\n//             body: JSON.stringify({ email, password }),\n//         });\n\n//         const data = await response.json();\n//         console.log('üì¶ Respuesta del login:', data);\n\n//         if (response.ok) {\n//             console.log('‚úÖ Login exitoso. Tokens recibidos:');\n//             console.log('Access Token:', data.access_token ? 'S√ç' : 'NO');\n//             console.log('Refresh Token:', data.refresh_token ? 'S√ç' : 'NO');\n//             console.log('User:', data.user ? 'S√ç' : 'NO');\n\n//             // Guardar en localStorage\n//             localStorage.setItem('access_token', data.access_token);\n//             localStorage.setItem('refresh_token', data.refresh_token);\n//             localStorage.setItem('user', JSON.stringify(data.user));\n\n//             console.log('üíæ Token guardado en localStorage:', \n//                 localStorage.getItem('access_token') ? 'S√ç' : 'NO');\n\n//             setUser(data.user);\n//             return { success: true, user: data.user };\n//         } else {\n//             console.log('‚ùå Error en login:', data.error);\n//             return { success: false, error: data.error || 'Error en el login' };\n//         }\n//     } catch (error) {\n//         console.log('üåê Error de conexi√≥n:', error);\n//         return { success: false, error: 'Error de conexi√≥n con el servidor' };\n//     }\n//   };\n\n//   const logout = async () => {\n//     try {\n//       const token = localStorage.getItem('access_token');\n//       if (token) {\n//         await fetch('http://localhost:5000/api/auth/logout', {\n//           method: 'POST',\n//           headers: {\n//             'Authorization': `Bearer ${token}`,\n//           },\n//         });\n//       }\n//     } catch (error) {\n//       console.error('Error durante logout:', error);\n//     } finally {\n//       setUser(null);\n//       localStorage.removeItem('user');\n//       localStorage.removeItem('access_token');\n//       localStorage.removeItem('refresh_token');\n//     }\n//   };\n\n//   const refreshToken = async () => {\n//     try {\n//       const refreshToken = localStorage.getItem('refresh_token');\n//       if (!refreshToken) {\n//         await logout();\n//         return false;\n//       }\n\n//       const response = await fetch('http://localhost:5000/api/auth/refresh', {\n//         method: 'POST',\n//         headers: {\n//           'Authorization': `Bearer ${refreshToken}`,\n//         },\n//       });\n\n//       const data = await response.json();\n\n//       if (response.ok) {\n//         localStorage.setItem('access_token', data.access_token);\n//         // üîß Si se genera un nuevo refresh token, reemplazar el anterior\n//         if (data.refresh_token) {\n//           localStorage.setItem('refresh_token', data.refresh_token);\n//         }\n//         if (data.user) {\n//           setUser(data.user);\n//           localStorage.setItem('user', JSON.stringify(data.user));\n//         }\n//         return true;\n//       } else {\n//         await logout();\n//         return false;\n//       }\n//     } catch (error) {\n//       console.error('Error refrescando token:', error);\n//       await logout();\n//       return false;\n//     }\n//   };\n\n//   const hasPermission = (permission) => {\n//     if (!user || !user.permissions) return false;\n//     return user.permissions.includes(permission);\n//   };\n\n//   // Funci√≥n para hacer requests autenticadas con refresh autom√°tico\n//   const authFetch = async (url, options = {}) => {\n//     let token = localStorage.getItem('access_token');\n\n//     const config = {\n//       ...options,\n//       headers: {\n//         'Content-Type': 'application/json',\n//         ...options.headers,\n//         'Authorization': `Bearer ${token}`,\n//       },\n//     };\n\n//     let response = await fetch(url, config);\n\n//     // Si el token expir√≥, intentar refrescar y reenviar la request\n//     if (response.status === 401) {\n//       const refreshed = await refreshToken();\n//       if (refreshed) {\n//         token = localStorage.getItem('access_token');\n//         config.headers.Authorization = `Bearer ${token}`;\n//         response = await fetch(url, config);\n//       }\n//     }\n\n//     return response;\n//   };\n\n//   return (\n//     <AuthContext.Provider value={{ \n//       user, \n//       login, \n//       logout, \n//       hasPermission, \n//       loading,\n//       authFetch \n//     }}>\n//       {children}\n//     </AuthContext.Provider>\n//   );\n// };\n\n////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n///////////////////////////////////////////////////////////////////////////////////////////////////////////////////////////\n\nimport React, { createContext, useContext, useEffect, useState, useRef } from 'react';\n\nconst AuthContext = createContext();\n\nexport const useAuth = () => useContext(AuthContext);\n\nexport const AuthProvider = ({ children }) => {\n  const [user, setUser] = useState(null);\n  const [loading, setLoading] = useState(true);\n  const [sessionExpiring, setSessionExpiring] = useState(false);\n\n  // ‚öôÔ∏è CONFIGURACI√ìN DE TIEMPOS (m√°s legible)\n  // Formato: { minutos: X, segundos: Y }\nconst TIEMPO_CONFIG = {\n  TOKEN_DURACION: { minutos: 1, segundos: 0 },      // 1 min (igual que backend)\n  REFRESH_ANTICIPADO: { minutos: 0, segundos: 10 }, // Refrescar 10s antes\n  AVISO_INACTIVIDAD: { minutos: 0, segundos: 45 },  // Aviso a los 45s\n  LOGOUT_INACTIVIDAD: { minutos: 1, segundos: 0 }   // Logout a 1 min\n};\n\n  // üîß Funci√≥n helper para convertir a milisegundos\n  const aMs = (config) => (config.minutos * 60 + config.segundos) * 1000;\n\n  // Constantes calculadas (NO MODIFICAR)\n  const ACCESS_TOKEN_LIFETIME = aMs(TIEMPO_CONFIG.TOKEN_DURACION);\n  const REFRESH_BEFORE_EXPIRY = aMs(TIEMPO_CONFIG.REFRESH_ANTICIPADO);\n  const INACTIVITY_WARNING = aMs(TIEMPO_CONFIG.AVISO_INACTIVIDAD);\n  const INACTIVITY_TIMEOUT = aMs(TIEMPO_CONFIG.LOGOUT_INACTIVIDAD);\n  const COUNTDOWN_SECONDS = Math.floor((INACTIVITY_TIMEOUT - INACTIVITY_WARNING) / 1000);\n\n  const [countdown, setCountdown] = useState(COUNTDOWN_SECONDS);\n\n  // üîí REFS para control de estado y prevenci√≥n de race conditions\n  const countdownRef = useRef(null);\n  const inactivityTimerRef = useRef(null);\n  const totalSessionTimerRef = useRef(null);\n  const sessionExpiringRef = useRef(sessionExpiring);\n  const refreshTimerRef = useRef(null);\n  const isRefreshingRef = useRef(false);\n  const refreshPromiseRef = useRef(null);\n  const tokenExpiryTimeRef = useRef(null);\n\n  useEffect(() => {\n    sessionExpiringRef.current = sessionExpiring;\n  }, [sessionExpiring]);\n\n  // ========================\n  // üü¢ Inicializaci√≥n de sesi√≥n\n  // ========================\n  useEffect(() => {\n    const initializeAuth = async () => {\n      const savedUser = localStorage.getItem('user');\n      const accessToken = localStorage.getItem('access_token');\n\n      if (savedUser && accessToken) {\n        setUser(JSON.parse(savedUser));\n        \n        // Establecer tiempo de expiraci√≥n del token\n        const tokenExpiry = localStorage.getItem('token_expiry');\n        if (tokenExpiry) {\n          tokenExpiryTimeRef.current = parseInt(tokenExpiry);\n          scheduleTokenRefresh();\n        }\n\n        try {\n          const response = await fetch('http://localhost:5000/api/users/profile', {\n            method: 'GET',\n            headers: { 'Authorization': `Bearer ${accessToken}` },\n          });\n          \n          if (!response.ok) {\n            // Token inv√°lido, intentar refresh\n            await refreshToken();\n          }\n        } catch (error) {\n          console.error('Error verificando token:', error);\n          await logout();\n        }\n      }\n      setLoading(false);\n    };\n\n    initializeAuth();\n  }, []);\n\n  // ========================\n  // üîÅ Sincronizar logout entre pesta√±as\n  // ========================\n  useEffect(() => {\n    const syncLogout = (e) => {\n      if (e.key === 'logout_event') {\n        setUser(null);\n        localStorage.removeItem('user');\n        localStorage.removeItem('access_token');\n        localStorage.removeItem('refresh_token');\n        localStorage.removeItem('token_expiry');\n        // NO usar navigate aqu√≠, ProtectedRoutes lo manejar√°\n      }\n    };\n    window.addEventListener('storage', syncLogout);\n    return () => window.removeEventListener('storage', syncLogout);\n  }, []);\n\n  // ========================\n  // üîÑ REFRESH PROACTIVO (antes de que expire)\n  // ========================\n  const scheduleTokenRefresh = () => {\n    // Limpiar timer anterior\n    if (refreshTimerRef.current) {\n      clearTimeout(refreshTimerRef.current);\n    }\n\n    const expiryTime = tokenExpiryTimeRef.current;\n    if (!expiryTime) return;\n\n    const now = Date.now();\n    const timeUntilRefresh = expiryTime - now - REFRESH_BEFORE_EXPIRY;\n\n    console.log(`üïê Token expira en: ${Math.round((expiryTime - now) / 1000)}s`);\n    console.log(`üîÑ Programando refresh en: ${Math.round(timeUntilRefresh / 1000)}s`);\n\n    if (timeUntilRefresh > 0) {\n      refreshTimerRef.current = setTimeout(async () => {\n        console.log('üîÑ Ejecutando refresh proactivo...');\n        await refreshToken();\n      }, timeUntilRefresh);\n    } else {\n      // Token ya expir√≥ o est√° por expirar, refresh inmediato\n      console.log('‚ö†Ô∏è Token ya expir√≥, refresh inmediato');\n      refreshToken();\n    }\n  };\n\n  // ========================\n  // üîí REFRESH CON LOCK (evita m√∫ltiples llamadas simult√°neas)\n  // ========================\n  const refreshToken = async () => {\n    // Si ya hay un refresh en progreso, esperar a que termine\n    if (isRefreshingRef.current && refreshPromiseRef.current) {\n      console.log('‚è≥ Refresh en progreso, esperando...');\n      return refreshPromiseRef.current;\n    }\n\n    // Marcar que estamos haciendo refresh\n    isRefreshingRef.current = true;\n    \n    refreshPromiseRef.current = (async () => {\n      try {\n        const refreshToken = localStorage.getItem('refresh_token');\n        if (!refreshToken) {\n          console.log('‚ùå No hay refresh token');\n          await logout();\n          return false;\n        }\n\n        console.log('üîÑ Ejecutando refresh token...');\n        const response = await fetch('http://localhost:5000/api/auth/refresh', {\n          method: 'POST',\n          headers: { 'Authorization': `Bearer ${refreshToken}` },\n        });\n\n        const data = await response.json();\n\n        if (response.ok) {\n          console.log('‚úÖ Refresh exitoso');\n          \n          // Guardar nuevos tokens\n          localStorage.setItem('access_token', data.access_token);\n          \n          if (data.refresh_token) {\n            localStorage.setItem('refresh_token', data.refresh_token);\n          }\n          \n          // Calcular y guardar tiempo de expiraci√≥n\n          const expiryTime = Date.now() + ACCESS_TOKEN_LIFETIME;\n          localStorage.setItem('token_expiry', expiryTime.toString());\n          tokenExpiryTimeRef.current = expiryTime;\n          \n          if (data.user) {\n            setUser(data.user);\n            localStorage.setItem('user', JSON.stringify(data.user));\n          }\n\n          // Programar pr√≥ximo refresh\n          scheduleTokenRefresh();\n          \n          return true;\n        } else {\n          console.log('‚ùå Refresh fall√≥:', data.error);\n          await logout();\n          return false;\n        }\n      } catch (error) {\n        console.error('‚ùå Error en refresh:', error);\n        await logout();\n        return false;\n      } finally {\n        // Liberar el lock\n        isRefreshingRef.current = false;\n        refreshPromiseRef.current = null;\n      }\n    })();\n\n    return refreshPromiseRef.current;\n  };\n\n  // ========================\n  // ‚è∞ Control de inactividad (SEPARADO del refresh de token)\n  // ========================\n  useEffect(() => {\n    if (!user) return;\n\n    const resetInactivityTimers = () => {\n      // NO resetear si el modal ya est√° visible\n      if (sessionExpiringRef.current) return;\n\n      clearTimeout(inactivityTimerRef.current);\n      clearTimeout(totalSessionTimerRef.current);\n      clearInterval(countdownRef.current);\n      setSessionExpiring(false);\n      setCountdown(COUNTDOWN_SECONDS);\n\n      // Timer para mostrar aviso\n      inactivityTimerRef.current = setTimeout(() => {\n        setSessionExpiring(true);\n        startCountdown();\n      }, INACTIVITY_WARNING);\n\n      // Timer para logout autom√°tico\n      totalSessionTimerRef.current = setTimeout(() => {\n        handleAutoLogout();\n      }, INACTIVITY_TIMEOUT);\n    };\n\n    const startCountdown = () => {\n      console.log('‚è≥ Mostrando aviso de inactividad');\n      let remaining = COUNTDOWN_SECONDS;\n      setCountdown(remaining);\n\n      clearInterval(countdownRef.current);\n      countdownRef.current = setInterval(() => {\n        remaining -= 1;\n        setCountdown(remaining);\n        if (remaining <= 0) {\n          clearInterval(countdownRef.current);\n        }\n      }, 1000);\n    };\n\n    const handleAutoLogout = async () => {\n      console.log('üö™ Logout autom√°tico por inactividad');\n      clearInterval(countdownRef.current);\n      setSessionExpiring(false);\n      await logout();\n    };\n\n    const handleUserActivity = () => {\n      // Si el modal est√° visible, NO resetear\n      if (sessionExpiringRef.current) return;\n      resetInactivityTimers();\n    };\n\n    // Suscribir eventos de actividad\n    window.addEventListener('mousemove', handleUserActivity);\n    window.addEventListener('keydown', handleUserActivity);\n    window.addEventListener('scroll', handleUserActivity);\n    window.addEventListener('click', handleUserActivity);\n\n    // Inicializar timers\n    resetInactivityTimers();\n\n    return () => {\n      window.removeEventListener('mousemove', handleUserActivity);\n      window.removeEventListener('keydown', handleUserActivity);\n      window.removeEventListener('scroll', handleUserActivity);\n      window.removeEventListener('click', handleUserActivity);\n\n      clearTimeout(inactivityTimerRef.current);\n      clearTimeout(totalSessionTimerRef.current);\n      clearInterval(countdownRef.current);\n    };\n  }, [user]);\n\n  // ========================\n  // üîÅ Extender sesi√≥n (bot√≥n \"Mantener sesi√≥n\")\n  // ========================\n  const extendSession = () => {\n    console.log('‚úÖ Usuario extendi√≥ la sesi√≥n');\n    \n    // Ocultar modal\n    setSessionExpiring(false);\n    setCountdown(COUNTDOWN_SECONDS);\n    \n    // Limpiar timers de inactividad\n    clearTimeout(inactivityTimerRef.current);\n    clearTimeout(totalSessionTimerRef.current);\n    clearInterval(countdownRef.current);\n\n    // Reiniciar timers\n    inactivityTimerRef.current = setTimeout(() => {\n      setSessionExpiring(true);\n      let remaining = COUNTDOWN_SECONDS;\n      setCountdown(remaining);\n      clearInterval(countdownRef.current);\n      countdownRef.current = setInterval(() => {\n        remaining -= 1;\n        setCountdown(remaining);\n        if (remaining <= 0) clearInterval(countdownRef.current);\n      }, 1000);\n    }, INACTIVITY_WARNING);\n\n    totalSessionTimerRef.current = setTimeout(async () => {\n      clearInterval(countdownRef.current);\n      setSessionExpiring(false);\n      await logout();\n    }, INACTIVITY_TIMEOUT);\n  };\n\n  // ========================\n  // üîê Login\n  // ========================\n  const login = async (email, password) => {\n    try {\n      const response = await fetch('http://localhost:5000/api/auth/login', {\n        method: 'POST',\n        headers: { 'Content-Type': 'application/json' },\n        body: JSON.stringify({ email, password }),\n      });\n\n      const data = await response.json();\n\n      if (response.ok) {\n        // Guardar tokens\n        localStorage.setItem('access_token', data.access_token);\n        localStorage.setItem('refresh_token', data.refresh_token);\n        localStorage.setItem('user', JSON.stringify(data.user));\n        \n        // Guardar tiempo de expiraci√≥n\n        const expiryTime = Date.now() + ACCESS_TOKEN_LIFETIME;\n        localStorage.setItem('token_expiry', expiryTime.toString());\n        tokenExpiryTimeRef.current = expiryTime;\n        \n        setUser(data.user);\n        \n        // Programar refresh proactivo\n        scheduleTokenRefresh();\n        \n        return { success: true, user: data.user };\n      } else {\n        return { success: false, error: data.error || 'Error en el login' };\n      }\n    } catch (error) {\n      return { success: false, error: 'Error de conexi√≥n con el servidor' };\n    }\n  };\n\n  // ========================\n  // üö™ Logout\n  // ========================\n  const logout = async () => {\n    try {\n      setSessionExpiring(false);\n      \n      // Limpiar todos los timers\n      clearTimeout(refreshTimerRef.current);\n      clearTimeout(inactivityTimerRef.current);\n      clearTimeout(totalSessionTimerRef.current);\n      clearInterval(countdownRef.current);\n\n      const token = localStorage.getItem('access_token');\n      if (token) {\n        await fetch('http://localhost:5000/api/auth/logout', {\n          method: 'POST',\n          headers: { 'Authorization': `Bearer ${token}` },\n        });\n      }\n    } catch (error) {\n      console.error('Error durante logout:', error);\n    } finally {\n      setUser(null);\n      localStorage.removeItem('user');\n      localStorage.removeItem('access_token');\n      localStorage.removeItem('refresh_token');\n      localStorage.removeItem('token_expiry');\n      localStorage.setItem('logout_event', Date.now());\n      \n      // Resetear refs\n      isRefreshingRef.current = false;\n      refreshPromiseRef.current = null;\n      tokenExpiryTimeRef.current = null;\n      \n      // ProtectedRoutes en App.js detectar√° user=null y redirigir√° a /login\n    }\n  };\n\n  // ========================\n  // üîë hasPermission\n  // ========================\n  const hasPermission = (permission) => {\n    if (!user || !user.permissions) return false;\n    return user.permissions.includes(permission);\n  };\n\n  // ========================\n  // üåê authFetch con lock anti-race-condition\n  // ========================\n  const authFetch = async (url, options = {}) => {\n    let token = localStorage.getItem('access_token');\n\n    const config = {\n      ...options,\n      headers: {\n        'Content-Type': 'application/json',\n        ...options.headers,\n        'Authorization': `Bearer ${token}`,\n      },\n    };\n\n    let response = await fetch(url, config);\n\n    // Si el token expir√≥ (401), intentar refresh UNA VEZ\n    if (response.status === 401) {\n      console.log('üîÑ Token expirado, intentando refresh...');\n      \n      const refreshed = await refreshToken();\n      \n      if (refreshed) {\n        // Reintentar request con nuevo token\n        token = localStorage.getItem('access_token');\n        config.headers.Authorization = `Bearer ${token}`;\n        response = await fetch(url, config);\n      }\n    }\n\n    return response;\n  };\n\n  return (\n    <AuthContext.Provider value={{\n      user,\n      login,\n      logout,\n      hasPermission,\n      loading,\n      authFetch,\n      sessionExpiring,\n      countdown,\n      extendSession\n    }}>\n      {children}\n\n      {/* üîî Modal de inactividad */}\n      {sessionExpiring && (\n        <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-[9999]\">\n          <div className=\"bg-white p-6 rounded-2xl shadow-lg text-center max-w-sm\">\n            <h2 className=\"text-lg font-semibold mb-2 text-gray-800\">\n              Sesi√≥n a punto de expirar\n            </h2>\n            <p className=\"text-gray-600 mb-4\">\n              Tu sesi√≥n se cerrar√° autom√°ticamente en <b>{countdown}s</b> por inactividad.\n            </p>\n            <div className=\"flex justify-center gap-4\">\n              <button\n                onClick={extendSession}\n                className=\"px-4 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\"\n              >\n                Mantener sesi√≥n\n              </button>\n              <button\n                onClick={logout}\n                className=\"px-4 py-2 bg-gray-300 text-gray-800 rounded-lg hover:bg-gray-400\"\n              >\n                Cerrar ahora\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n    </AuthContext.Provider>\n  );\n};"],"mappings":";;;AAAA;;AAEA;;AAEA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;;AAEA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;AAEA;AACA;AACA;AACA;AACA;;AAEA,OAAOA,KAAK,IAAIC,aAAa,EAAEC,UAAU,EAAEC,SAAS,EAAEC,QAAQ,EAAEC,MAAM,QAAQ,OAAO;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAEtF,MAAMC,WAAW,gBAAGP,aAAa,CAAC,CAAC;AAEnC,OAAO,MAAMQ,OAAO,GAAGA,CAAA;EAAAC,EAAA;EAAA,OAAMR,UAAU,CAACM,WAAW,CAAC;AAAA;AAACE,EAAA,CAAxCD,OAAO;AAEpB,OAAO,MAAME,YAAY,GAAGA,CAAC;EAAEC;AAAS,CAAC,KAAK;EAAAC,GAAA;EAC5C,MAAM,C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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}